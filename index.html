<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calc</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Special+Gothic+Expanded+One&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Ubuntu Mono', monospace;
            background: #ffffff;
            color: #000000;
            overflow: hidden;
            touch-action: pan-y;
        }

        /* Splash Screen */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .splash-text {
            font-family: 'Special Gothic Expanded One', sans-serif;
            font-size: 4rem;
            font-weight: bold;
            color: #000000;
            text-align: center;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }

        .splash-text.calc {
            font-size: 3rem;
            animation: fadeInScale 0.8s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes buttonPress {
            0% { transform: scale(1); }
            50% { transform: scale(0.92); }
            100% { transform: scale(1); }
        }

        .button-press {
            animation: buttonPress 0.15s ease;
        }

        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 8px;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .app-container.loaded {
            opacity: 1;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8px;
        }

        .header-btn {
            background: #000000;
            border: none;
            border-radius: 12px;
            color: #ffffff;
            padding: 10px 16px;
            font-size: 14px;
            cursor: pointer;
            font-family: 'Ubuntu Mono', monospace;
            font-weight: 700;
            transition: all 0.1s;
        }

        .header-btn:active {
            background: #333333;
            transform: scale(0.95);
        }

        /* Display */
        .display-container {
            flex: 1;
            background: #f8f9fa;
            border-radius: 24px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            min-height: 120px;
            position: relative;
        }

        .memory-indicator {
            position: absolute;
            top: 12px;
            left: 20px;
            font-size: 12px;
            color: #666;
        }

        .expression {
            font-size: 16px;
            color: #666;
            margin-bottom: 12px;
            word-wrap: break-word;
            overflow-x: auto;
            white-space: nowrap;
        }

        .result {
            font-size: 32px;
            font-weight: 700;
            color: #000000;
            text-align: right;
            word-wrap: break-word;
            overflow-x: auto;
        }

        /* Mode Tabs */
        .mode-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 20px;
            padding: 4px;
            gap: 4px;
        }

        .mode-tab {
            flex: 1;
            padding: 12px 8px;
            background: transparent;
            border: none;
            color: #000000;
            font-size: 12px;
            cursor: pointer;
            border-radius: 16px;
            transition: all 0.2s;
            font-family: 'Ubuntu Mono', monospace;
        }

        .mode-tab.active {
            background: #000000;
            color: #ffffff;
            font-weight: 700;
        }

        /* Content Area */
        .content-area {
            flex: 3;
            overflow: hidden;
            position: relative;
        }

        .mode-content {
            display: none;
            height: 100%;
            overflow-y: auto;
        }

        .mode-content.active {
            display: flex;
            flex-direction: column;
        }

        /* Calculator Keyboard */
        .calculator-keyboard {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            padding: 8px;
        }

        .calc-btn {
            background: #000000;
            border: none;
            border-radius: 20px;
            color: #ffffff;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 50px;
            font-family: 'Ubuntu Mono', monospace;
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }

        .calc-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .calc-btn:active::after {
            width: 100px;
            height: 100px;
        }

        .calc-btn:active {
            background: #333333;
        }

        .calc-btn.operator {
            background: #2d2d2d;
        }

        .calc-btn.function {
            background: #404040;
            font-size: 14px;
        }

        .calc-btn.memory {
            background: #505050;
            font-size: 12px;
        }

        .calc-btn.equals {
            background: #000000;
        }

        .calc-btn.clear {
            background: #404040;
        }

        /* Advanced Functions Panel */
        .advanced-panel {
            background: #f8f9fa;
            padding: 12px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            border-radius: 20px;
            margin: 8px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s;
        }

        .advanced-panel.open {
            max-height: 300px;
        }

        .adv-btn {
            background: #000000;
            border: none;
            padding: 12px 8px;
            font-size: 12px;
            border-radius: 16px;
            cursor: pointer;
            color: #ffffff;
            transition: all 0.2s;
            font-family: 'Ubuntu Mono', monospace;
        }

        .adv-btn:active {
            background: #333333;
            transform: scale(0.95);
        }

        /* Scientific functions grid */
        .scientific-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 20px;
            margin: 8px;
        }

        .sci-btn {
            background: #000000;
            border: none;
            border-radius: 16px;
            color: #ffffff;
            padding: 12px 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Ubuntu Mono', monospace;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sci-btn:active {
            background: #333333;
            transform: scale(0.95);
        }

        /* Memory Panel */
        .memory-panel {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 20px;
            margin: 8px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s;
        }

        .memory-panel.open {
            max-height: 200px;
            overflow-y: auto;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .memory-cell {
            padding: 8px;
            background: #ffffff;
            border: 1px solid #000000;
            border-radius: 8px;
            text-align: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .memory-cell:active {
            background: #f0f0f0;
            transform: scale(0.95);
        }

        .memory-cell.used {
            background: #000000;
            color: #ffffff;
        }

        /* Graph Container */
        .graph-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: #f8f9fa;
            border-radius: 20px;
            touch-action: none;
        }

        #graphCanvas {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 20px;
        }

        .graph-controls {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .graph-btn {
            background: white;
            border: 1px solid #000000;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .graph-btn:active {
            transform: scale(0.9);
        }

        .function-input {
            position: absolute;
            bottom: 12px;
            left: 12px;
            right: 12px;
            background: white;
            border-radius: 8px;
            padding: 12px;
            border: 2px solid #000000;
        }

        .function-input input {
            width: 100%;
            padding: 10px;
            border: 1px solid #000000;
            border-radius: 6px;
            font-size: 16px;
            font-family: 'Ubuntu Mono', monospace;
        }

        /* Fraction Calculator */
        .fraction-calculator {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 16px;
            gap: 12px;
        }

        .fraction-type-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .fraction-type-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #000000;
            background: #ffffff;
            border-radius: 16px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            font-family: 'Ubuntu Mono', monospace;
            font-weight: 700;
        }

        .fraction-type-btn.active {
            background: #000000;
            color: #ffffff;
        }

        .fraction-type-btn:active {
            transform: scale(0.95);
        }

        .fraction-inputs {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 20px;
        }

        .fraction-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }

        .fraction-numerator, .fraction-denominator {
            padding: 4px 12px;
            text-align: center;
            font-size: 18px;
            font-weight: 700;
        }

        .fraction-line {
            width: 100%;
            height: 2px;
            background: #000000;
            margin: 2px 0;
        }

        .fraction-input {
            width: 60px;
            padding: 12px;
            border: 2px solid #000000;
            border-radius: 12px;
            font-size: 16px;
            text-align: center;
            background: #ffffff;
            color: #000000;
            font-family: 'Ubuntu Mono', monospace;
        }

        .fraction-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .fraction-result {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 20px;
            text-align: center;
            border: 2px solid #000000;
        }

        .fraction-simplification {
            background: #f8f9fa;
            color: #000000;
            padding: 12px;
            border-radius: 16px;
            font-size: 14px;
            border: 2px solid #000000;
        }

        .simplification-steps {
            margin-top: 8px;
        }

        .fraction-step {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 8px 0;
        }

        .crossed-number {
            position: relative;
            display: inline-block;
            padding: 0 4px;
        }

        .crossed-number::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #000000;
            transform: rotate(-15deg);
        }

        .fraction-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            flex: 1;
            padding: 16px;
            border: 2px solid #000000;
            border-radius: 16px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Ubuntu Mono', monospace;
            font-weight: 700;
        }

        .action-btn.primary {
            background: #000000;
            color: #ffffff;
        }

        .action-btn.secondary {
            background: #ffffff;
            color: #000000;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        /* Solver Container */
        .solver-container {
            padding: 16px;
            overflow-y: auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .solver-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .solver-input-group label {
            font-weight: 700;
            color: #000000;
        }

        .solver-input-group input,
        .solver-input-group select {
            padding: 16px;
            border: 2px solid #000000;
            border-radius: 16px;
            font-size: 16px;
            background: #ffffff;
            color: #000000;
            font-family: 'Ubuntu Mono', monospace;
        }

        .solve-btn {
            padding: 16px;
            background: #000000;
            color: #ffffff;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Ubuntu Mono', monospace;
            transition: all 0.2s;
        }

        .solve-btn:active {
            background: #333333;
            transform: scale(0.98);
        }

        .solution-steps {
            margin-top: 20px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #000000;
        }

        .step {
            padding: 12px;
            margin-bottom: 12px;
            background: #ffffff;
            border-left: 3px solid #000000;
            border-radius: 4px;
        }

        .step-title {
            font-weight: 600;
            color: #000000;
            margin-bottom: 6px;
        }

        .step-content {
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        /* History */
        .history-container {
            padding: 16px;
            overflow-y: auto;
            height: 100%;
        }

        .history-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #000000;
        }

        .history-item:active {
            background: #e0e0e0;
            transform: scale(0.98);
        }

        .history-expression {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }

        .history-result {
            font-size: 18px;
            font-weight: 600;
            color: #000000;
        }

        /* Matrix Input */
        .matrix-input {
            display: grid;
            gap: 8px;
            margin-bottom: 16px;
        }

        .matrix-row {
            display: flex;
            gap: 8px;
        }

        .matrix-cell {
            flex: 1;
            padding: 10px;
            border: 1px solid #000000;
            border-radius: 4px;
            text-align: center;
            font-size: 16px;
            background: #ffffff;
            color: #000000;
            font-family: 'Ubuntu Mono', monospace;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #ffffff;
            border-radius: 20px;
            padding: 24px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            border: 2px solid #000000;
        }

        .modal-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #000000;
            text-align: center;
        }

        .modal-close {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #000000;
        }

        .mode-option {
            padding: 16px;
            margin: 8px 0;
            background: #f8f9fa;
            border: 2px solid #000000;
            border-radius: 16px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            font-family: 'Ubuntu Mono', monospace;
            font-weight: 700;
        }

        .mode-option:hover, .mode-option.active {
            background: #000000;
            color: #ffffff;
        }

        .mode-option:active {
            transform: scale(0.95);
        }

        .mode-description {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        /* Settings Modal */
        .settings-group {
            margin-bottom: 20px;
        }

        .settings-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .settings-group select, .settings-group input[type="range"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #000000;
            border-radius: 12px;
            font-family: 'Ubuntu Mono', monospace;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid #f8f9fa;
            border-top: 3px solid #000000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (min-width: 768px) {
            .app-container {
                max-width: 400px;
                margin: 0 auto;
            }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            .display-container {
                min-height: 80px;
                padding: 12px;
            }
            
            .result {
                font-size: 24px;
            }
            
            .calculator-keyboard {
                grid-template-columns: repeat(6, 1fr);
                gap: 6px;
                padding: 6px;
            }
            
            .calc-btn {
                font-size: 14px;
                min-height: 40px;
                border-radius: 16px;
            }

            .scientific-grid {
                grid-template-columns: repeat(6, 1fr);
            }

            .sci-btn {
                min-height: 35px;
                font-size: 12px;
            }
        }

        /* Special modes */
        .calculator-keyboard.beginner {
            grid-template-columns: repeat(4, 1fr);
        }

        .calculator-keyboard.beginner .calc-btn {
            font-size: 20px;
            min-height: 70px;
        }

        .calculator-keyboard.ovz {
            grid-template-columns: repeat(3, 1fr);
        }

        .calculator-keyboard.ovz .calc-btn {
            font-size: 32px;
            min-height: 90px;
            border-radius: 25px;
            background: #000000;
            color: #ffffff;
            font-weight: 900;
            border: 3px solid #000000;
        }

        .calculator-keyboard.ovz .calc-btn:active {
            background: #ffffff;
            color: #000000;
        }

        .calculator-keyboard.middle .calc-btn {
            border-radius: 18px;
        }

        .calculator-keyboard.gia .calc-btn {
            border-radius: 16px;
        }

        .mode-computational {
            background: #000000;
            color: #ffffff;
        }

        .mode-graphing {
            background: #2d2d2d;
            color: #ffffff;
        }

        .mode-programming {
            background: #404040;
            color: #ffffff;
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="splash-text" id="splashLeo">leo.</div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <div class="header">
            <button class="header-btn" id="modeBtn">MODE</button>
            <button class="header-btn" id="settingsBtn">‚ãØ</button>
        </div>

        <!-- Display -->
        <div class="display-container">
            <div class="memory-indicator" id="memoryIndicator">M</div>
            <div class="expression" id="expression"></div>
            <div class="result" id="result">0</div>
        </div>

        <!-- Mode Tabs -->
        <div class="mode-tabs">
            <button class="mode-tab active" data-mode="calculator">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
            <button class="mode-tab" data-mode="fractions">–î—Ä–æ–±–∏</button>
            <button class="mode-tab" data-mode="graph">–ì—Ä–∞—Ñ–∏–∫–∏</button>
            <button class="mode-tab" data-mode="solver">–†–µ—à–∞—Ç–µ–ª—å</button>
            <button class="mode-tab" data-mode="matrix">–ú–∞—Ç—Ä–∏—Ü—ã</button>
            <button class="mode-tab" data-mode="history">–ò—Å—Ç–æ—Ä–∏—è</button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Calculator Mode -->
            <div class="mode-content active" id="calculator-mode">
                <!-- Memory Panel -->
                <div class="memory-panel" id="memoryPanel">
                    <div class="memory-grid" id="memoryGrid"></div>
                </div>

                <!-- Advanced Functions Panel -->
                <div class="advanced-panel" id="advancedPanel">
                    <button class="adv-btn" data-func="sin">sin</button>
                    <button class="adv-btn" data-func="cos">cos</button>
                    <button class="adv-btn" data-func="tan">tan</button>
                    <button class="adv-btn" data-func="sin‚Åª¬π">sin‚Åª¬π</button>
                    <button class="adv-btn" data-func="cos‚Åª¬π">cos‚Åª¬π</button>
                    <button class="adv-btn" data-func="sinh">sinh</button>
                    <button class="adv-btn" data-func="cosh">cosh</button>
                    <button class="adv-btn" data-func="tanh">tanh</button>
                    <button class="adv-btn" data-func="log">log</button>
                    <button class="adv-btn" data-func="ln">ln</button>
                    <button class="adv-btn" data-func="‚àö">‚àö</button>
                    <button class="adv-btn" data-func="¬≥‚àö">¬≥‚àö</button>
                    <button class="adv-btn" data-func="x¬≤">x¬≤</button>
                    <button class="adv-btn" data-func="x¬≥">x¬≥</button>
                    <button class="adv-btn" data-func="x^y">x^y</button>
                    <button class="adv-btn" data-func="œÄ">œÄ</button>
                    <button class="adv-btn" data-func="e">e</button>
                    <button class="adv-btn" data-func="nCr">nCr</button>
                    <button class="adv-btn" data-func="nPr">nPr</button>
                    <button class="adv-btn" data-func="hyp">hyp</button>
                    <button class="adv-btn" data-func="Pol(">Pol(</button>
                    <button class="adv-btn" data-func="Rec(">Rec(</button>
                    <button class="adv-btn" data-func="S‚áÑD">S‚áÑD</button>
                    <button class="adv-btn" data-func="(--)">(--)</button>
                    <button class="adv-btn" data-func="Ans">Ans</button>
                </div>

                <!-- Scientific Functions -->
                <div class="scientific-grid" id="scientificPanel">
                    <button class="sci-btn" data-func="sin">sin</button>
                    <button class="sci-btn" data-func="cos">cos</button>
                    <button class="sci-btn" data-func="tan">tan</button>
                    <button class="sci-btn" data-func="log">log</button>
                    <button class="sci-btn" data-func="ln">ln</button>
                    <button class="sci-btn" data-func="‚àö">‚àö</button>
                    <button class="sci-btn" data-func="x¬≤">x¬≤</button>
                    <button class="sci-btn" data-func="x^y">x^y</button>
                    <button class="sci-btn" data-func="œÄ">œÄ</button>
                    <button class="sci-btn" data-func="e">e</button>
                    <button class="sci-btn" data-func="nCr">nCr</button>
                    <button class="sci-btn" data-func="nPr">nPr</button>
                    <button class="sci-btn" data-func="(--)">(-)</button>
                    <button class="sci-btn" data-func="Ans">Ans</button>
                    <button class="sci-btn" data-func="(">(</button>
                    <button class="sci-btn" data-func=")">)</button>
                    <button class="sci-btn" data-func=",">,</button>
                </div>

                <!-- Calculator Keyboard -->
                <div class="calculator-keyboard" id="mainKeyboard">
                    <button class="calc-btn memory" data-action="mc">MC</button>
                    <button class="calc-btn memory" data-action="mr">MR</button>
                    <button class="calc-btn memory" data-action="m+">M+</button>
                    <button class="calc-btn memory" data-action="m-">M-</button>
                    <button class="calc-btn clear" data-action="clear">C</button>

                    <button class="calc-btn function" data-action="backspace">‚å´</button>
                    <button class="calc-btn function" data-action="percent">%</button>
                    <button class="calc-btn function" data-action="1/x">1/x</button>
                    <button class="calc-btn function" data-action="factorial">x!</button>
                    <button class="calc-btn operator" data-action="divide">/</button>

                    <button class="calc-btn" data-value="7">7</button>
                    <button class="calc-btn" data-value="8">8</button>
                    <button class="calc-btn" data-value="9">9</button>
                    <button class="calc-btn function" data-action="memory-toggle">M</button>
                    <button class="calc-btn operator" data-action="multiply">√ó</button>

                    <button class="calc-btn" data-value="4">4</button>
                    <button class="calc-btn" data-value="5">5</button>
                    <button class="calc-btn" data-value="6">6</button>
                    <button class="calc-btn function" data-action="advanced-toggle">f(x)</button>
                    <button class="calc-btn operator" data-action="subtract">‚àí</button>

                    <button class="calc-btn" data-value="1">1</button>
                    <button class="calc-btn" data-value="2">2</button>
                    <button class="calc-btn" data-value="3">3</button>
                    <button class="calc-btn function" data-action="alpha">A</button>
                    <button class="calc-btn operator" data-action="add">+</button>

                    <button class="calc-btn function" data-action="negate">¬±</button>
                    <button class="calc-btn" data-value="0">0</button>
                    <button class="calc-btn" data-value=".">,</button>
                    <button class="calc-btn function" data-action="fraction">a b/c</button>
                    <button class="calc-btn equals" data-action="equals">=</button>
                </div>
            </div>

            <!-- Fractions Mode -->
            <div class="mode-content" id="fractions-mode">
                <div class="fraction-calculator">
                    <div class="fraction-type-selector">
                        <button class="fraction-type-btn active" data-type="proper">a/b</button>
                        <button class="fraction-type-btn" data-type="mixed">n a/b</button>
                        <button class="fraction-type-btn" data-type="decimal">0,00</button>
                    </div>

                    <div class="fraction-inputs" id="fractionInputs">
                        <div class="fraction-display">
                            <div class="fraction-numerator" id="num1">1</div>
                            <div class="fraction-line"></div>
                            <div class="fraction-denominator" id="den1">2</div>
                        </div>
                        <select class="fraction-input" id="fracOperator">
                            <option value="+">+</option>
                            <option value="-">‚àí</option>
                            <option value="*">√ó</option>
                            <option value="/">√∑</option>
                        </select>
                        <div class="fraction-display">
                            <div class="fraction-numerator" id="num2">1</div>
                            <div class="fraction-line"></div>
                            <div class="fraction-denominator" id="den2">3</div>
                        </div>
                        <span>=</span>
                        <div class="fraction-display" id="resultFraction">
                            <div class="fraction-numerator">?</div>
                            <div class="fraction-line"></div>
                            <div class="fraction-denominator">?</div>
                        </div>
                    </div>

                    <div class="fraction-controls">
                        <input type="number" class="fraction-input" id="inputNum1" value="1">
                        <input type="number" class="fraction-input" id="inputDen1" value="2">
                        <input type="number" class="fraction-input" id="inputNum2" value="1">
                        <input type="number" class="fraction-input" id="inputDen2" value="3">
                    </div>

                    <div class="fraction-result" id="fractionResult">=</div>

                    <div class="fraction-simplification" id="simplificationPanel" style="display: none;">
                        <strong>–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ:</strong>
                        <div class="simplification-steps" id="simplificationSteps"></div>
                    </div>

                    <div class="fraction-actions">
                        <button class="action-btn secondary" id="simplifyBtn">–°–æ–∫—Ä–∞—Ç–∏—Ç—å</button>
                        <button class="action-btn primary" id="calculateFractions">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                    </div>
                </div>
            </div>

            <!-- Graph Mode -->
            <div class="mode-content" id="graph-mode">
                <div class="graph-container">
                    <canvas id="graphCanvas"></canvas>
                    <div class="graph-controls">
                        <button class="graph-btn" id="zoomIn">+</button>
                        <button class="graph-btn" id="zoomOut">‚àí</button>
                        <button class="graph-btn" id="resetView">‚ü≤</button>
                        <button class="graph-btn" id="addFunction">üìà</button>
                    </div>
                    <div class="function-input" id="functionInput" style="display: none;">
                        <input type="text" placeholder="y = f(x), –Ω–∞–ø—Ä–∏–º–µ—Ä: x^2 + 2*x - 1" id="functionExpression">
                        <button class="solve-btn" id="plotFunction">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å</button>
                    </div>
                </div>
            </div>

            <!-- Solver Mode -->
            <div class="mode-content" id="solver-mode">
                <div class="solver-container">
                    <div class="solver-input-group">
                        <label>–¢–∏–ø –∑–∞–¥–∞—á–∏:</label>
                        <select id="solverType">
                            <option value="equation">–£—Ä–∞–≤–Ω–µ–Ω–∏–µ</option>
                            <option value="derivative">–ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è</option>
                            <option value="integral">–ò–Ω—Ç–µ–≥—Ä–∞–ª</option>
                            <option value="limit">–ü—Ä–µ–¥–µ–ª</option>
                            <option value="factor">–†–∞–∑–ª–æ–∂–µ–Ω–∏–µ</option>
                        </select>
                    </div>

                    <div class="solver-input-group">
                        <label>–í—ã—Ä–∞–∂–µ–Ω–∏–µ:</label>
                        <input type="text" id="solverExpression" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: x^2 + 5*x + 6 = 0">
                    </div>

                    <div class="solver-input-group" id="variableGroup">
                        <label>–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è:</label>
                        <input type="text" id="solverVariable" value="x" placeholder="x">
                    </div>

                    <button class="solve-btn" id="solveBtn">–†–µ—à–∏—Ç—å</button>

                    <div class="solution-steps" id="solutionSteps" style="display: none;"></div>
                </div>
            </div>

            <!-- Matrix Mode -->
            <div class="mode-content" id="matrix-mode">
                <div class="solver-container">
                    <div class="solver-input-group">
                        <label>–†–∞–∑–º–µ—Ä –º–∞—Ç—Ä–∏—Ü—ã:</label>
                        <select id="matrixSize">
                            <option value="2">2√ó2</option>
                            <option value="3" selected>3√ó3</option>
                            <option value="4">4√ó4</option>
                        </select>
                    </div>

                    <div class="solver-input-group">
                        <label>–ú–∞—Ç—Ä–∏—Ü–∞ A:</label>
                        <div class="matrix-input" id="matrixA"></div>
                    </div>

                    <div class="solver-input-group">
                        <label>–û–ø–µ—Ä–∞—Ü–∏—è:</label>
                        <select id="matrixOperation">
                            <option value="determinant">–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å</option>
                            <option value="inverse">–û–±—Ä–∞—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞</option>
                            <option value="transpose">–¢—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                            <option value="eigenvalues">–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</option>
                        </select>
                    </div>

                    <button class="solve-btn" id="matrixSolveBtn">–í—ã—á–∏—Å–ª–∏—Ç—å</button>

                    <div class="solution-steps" id="matrixResult" style="display: none;"></div>
                </div>
            </div>

            <!-- History Mode -->
            <div class="mode-content" id="history-mode">
                <div class="history-container" id="historyContainer"></div>
            </div>
        </div>
    </div>

    <!-- Mode Selection Modal -->
    <div class="modal" id="modeModal">
        <div class="modal-content">
            <div class="modal-header">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º</div>
            
            <div class="mode-option mode-computational" data-mode="computational">
                –í—ã—á–∏—Å–ª–µ–Ω–∏—è
                <div class="mode-description">–ë–∞–∑–æ–≤—ã–µ –∏ –Ω–∞—É—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è</div>
            </div>
            
            <div class="mode-option mode-graphing" data-mode="graphing">
                –ì—Ä–∞—Ñ–∏–∫–∏
                <div class="mode-description">–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π</div>
            </div>
            
            <div class="mode-option mode-programming" data-mode="programming">
                –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
                <div class="mode-description">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è</div>
            </div>

            <div class="modal-header" style="margin-top: 20px;">–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</div>
            
            <div class="mode-option" data-complexity="beginner">
                –ù–∞—á–∞–ª—å–Ω–∞—è —à–∫–æ–ª–∞
                <div class="mode-description">–ë–æ–ª—å—à–∏–µ –∫–Ω–æ–ø–∫–∏, —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤—ã</div>
            </div>
            <div class="mode-option" data-complexity="middle">
                –°—Ä–µ–¥–Ω—è—è —à–∫–æ–ª–∞
                <div class="mode-description">–î—Ä–æ–±–∏, –ø—Ä–æ—Ü–µ–Ω—Ç—ã, —Å—Ç–µ–ø–µ–Ω–∏</div>
            </div>
            <div class="mode-option" data-complexity="gia">
                –ì–ò–ê –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
                <div class="mode-description">–í—Å–µ –¥–ª—è —ç–∫–∑–∞–º–µ–Ω–∞ 9 –∫–ª–∞—Å—Å</div>
            </div>
            <div class="mode-option" data-complexity="ovz">
                –û–í–ó
                <div class="mode-description">–í—ã—Å–æ–∫–æ–∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ –æ–≥—Ä–æ–º–Ω—ã–µ —Ü–∏—Ñ—Ä—ã</div>
            </div>
            <div class="mode-option active" data-complexity="balance">
                –ë–∞–ª–∞–Ω—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
                <div class="mode-description">–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π</div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            
            <div class="settings-group">
                <label>–ó–≤—É–∫–∏:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="soundToggle" checked>
                    <label for="soundToggle">–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–∏ –Ω–∞–∂–∞—Ç–∏–π</label>
                </div>
            </div>

            <div class="settings-group">
                <label>–í–∏–±—Ä–∞—Ü–∏—è:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="vibrationToggle" checked>
                    <label for="vibrationToggle">–í–∫–ª—é—á–∏—Ç—å –≤–∏–±—Ä–∞—Ü–∏—é</label>
                </div>
            </div>

            <div class="settings-group">
                <label>–†–∞–∑–º–µ—Ä –∫–Ω–æ–ø–æ–∫:</label>
                <input type="range" id="buttonSize" min="1" max="5" value="3">
            </div>

            <div class="settings-group">
                <label>–¢–æ—á–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π:</label>
                <select id="precisionSelect">
                    <option value="2">2 –∑–Ω–∞–∫–∞</option>
                    <option value="4">4 –∑–Ω–∞–∫–∞</option>
                    <option value="6" selected>6 –∑–Ω–∞–∫–æ–≤</option>
                    <option value="8">8 –∑–Ω–∞–∫–æ–≤</option>
                    <option value="10">10 –∑–Ω–∞–∫–æ–≤</option>
                </select>
            </div>

            <div class="settings-group">
                <label>–£–≥–ª–æ–≤–∞—è –º–µ—Ä–∞:</label>
                <select id="angleMode">
                    <option value="deg" selected>–ì—Ä–∞–¥—É—Å—ã</option>
                    <option value="rad">–†–∞–¥–∏–∞–Ω—ã</option>
                </select>
            </div>

            <button class="header-btn" style="width: 100%; margin-top: 20px;" id="closeSettings">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <script>
        // –û–ì–†–û–ú–ù–´–ô –ö–õ–ê–°–° –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê –°–û –í–°–ï–ú–ò –§–£–ù–ö–¶–ò–Ø–ú–ò
        class UltimateCalculator {
            constructor() {
                this.expression = '';
                this.result = '0';
                this.memory = Array(100).fill(null);
                this.currentMemory = 0;
                this.alphaMode = false;
                this.lastAnswer = null;
                this.currentMode = 'computational';
                this.currentComplexity = 'balance';
                this.soundEnabled = true;
                this.vibrationEnabled = true;
                this.precision = 6;
                this.angleMode = 'deg';
                this.history = this.loadHistory();
                this.graphState = {
                    scale: 40,
                    offsetX: 0,
                    offsetY: 0,
                    functions: []
                };
                
                this.initializeElements();
                this.setupSplashScreen();
                this.attachEventListeners();
                this.setupModals();
                this.initializeGraph();
                this.generateMemoryCells();
                this.generateMatrixInput(3);
                this.renderHistory();
                this.updateKeyboardForMode();
                this.loadSettings();
            }

            setupSplashScreen() {
                const splashScreen = document.getElementById('splashScreen');
                const splashLeo = document.getElementById('splashLeo');
                const appContainer = document.getElementById('appContainer');

                setTimeout(() => {
                    splashLeo.style.opacity = '1';
                    
                    setTimeout(() => {
                        splashLeo.textContent = 'calc';
                        splashLeo.classList.add('calc');
                        
                        setTimeout(() => {
                            splashScreen.style.opacity = '0';
                            setTimeout(() => {
                                splashScreen.style.display = 'none';
                                appContainer.classList.add('loaded');
                            }, 500);
                        }, 1000);
                    }, 1000);
                }, 100);
            }

            initializeElements() {
                this.expressionDisplay = document.getElementById('expression');
                this.resultDisplay = document.getElementById('result');
                this.memoryIndicator = document.getElementById('memoryIndicator');
                this.mainKeyboard = document.getElementById('mainKeyboard');
                this.scientificPanel = document.getElementById('scientificPanel');
                this.advancedPanel = document.getElementById('advancedPanel');
                this.memoryPanel = document.getElementById('memoryPanel');
                this.modeModal = document.getElementById('modeModal');
                this.settingsModal = document.getElementById('settingsModal');
                this.graphCanvas = document.getElementById('graphCanvas');
                this.ctx = this.graphCanvas.getContext('2d');
            }

            setupModals() {
                // Mode button
                document.getElementById('modeBtn').addEventListener('click', () => {
                    this.modeModal.classList.add('active');
                });

                // Settings button
                document.getElementById('settingsBtn').addEventListener('click', () => {
                    this.settingsModal.classList.add('active');
                });

                // Close settings
                document.getElementById('closeSettings').addEventListener('click', () => {
                    this.settingsModal.classList.remove('active');
                    this.saveSettings();
                });

                // Mode selection
                document.querySelectorAll('.mode-option[data-mode]').forEach(option => {
                    option.addEventListener('click', () => {
                        this.currentMode = option.dataset.mode;
                        this.updateKeyboardForMode();
                        option.classList.add('active');
                    });
                });

                document.querySelectorAll('.mode-option[data-complexity]').forEach(option => {
                    option.addEventListener('click', () => {
                        this.currentComplexity = option.dataset.complexity;
                        this.updateKeyboardForMode();
                        option.classList.add('active');
                    });
                });

                // Close modals
                [this.modeModal, this.settingsModal].forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('active');
                            if (modal === this.settingsModal) {
                                this.saveSettings();
                            }
                        }
                    });
                });

                // Settings controls
                document.getElementById('soundToggle').addEventListener('change', (e) => {
                    this.soundEnabled = e.target.checked;
                });

                document.getElementById('vibrationToggle').addEventListener('change', (e) => {
                    this.vibrationEnabled = e.target.checked;
                });

                document.getElementById('precisionSelect').addEventListener('change', (e) => {
                    this.precision = parseInt(e.target.value);
                });

                document.getElementById('angleMode').addEventListener('change', (e) => {
                    this.angleMode = e.target.value;
                });
            }

            // –í–ò–ó–£–ê–õ–¨–ù–´–ô –û–¢–ö–õ–ò–ö –ü–†–ò –ù–ê–ñ–ê–¢–ò–ò
            addButtonPressEffect(element) {
                element.classList.add('button-press');
                setTimeout(() => {
                    element.classList.remove('button-press');
                }, 150);
            }

            playSound() {
                if (this.soundEnabled) {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                }
            }

            vibrate() {
                if (this.vibrationEnabled && 'vibrate' in navigator) {
                    navigator.vibrate(10);
                }
            }

            attachEventListeners() {
                // Mode tabs
                document.querySelectorAll('.mode-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.addButtonPressEffect(e.target);
                        this.switchMode(tab.dataset.mode);
                    });
                });

                // All buttons
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('calc-btn') || 
                        e.target.classList.contains('sci-btn') || 
                        e.target.classList.contains('adv-btn') ||
                        e.target.classList.contains('action-btn') ||
                        e.target.classList.contains('solve-btn') ||
                        e.target.classList.contains('graph-btn') ||
                        e.target.classList.contains('header-btn') ||
                        e.target.classList.contains('memory-cell') ||
                        e.target.classList.contains('fraction-type-btn')) {
                        
                        this.addButtonPressEffect(e.target);
                        this.playSound();
                        this.vibrate();
                    }

                    // Handle different button types
                    if (e.target.classList.contains('calc-btn')) {
                        const value = e.target.dataset.value;
                        const action = e.target.dataset.action;
                        if (value !== undefined) this.appendValue(value);
                        else if (action) this.handleAction(action);
                    }

                    if (e.target.classList.contains('sci-btn') || e.target.classList.contains('adv-btn')) {
                        this.insertFunction(e.target.dataset.func);
                    }

                    if (e.target.classList.contains('memory-cell')) {
                        const index = parseInt(e.target.dataset.index);
                        this.useMemoryCell(index);
                    }
                });

                // Graph controls
                document.getElementById('zoomIn').addEventListener('click', () => this.zoom(1.2));
                document.getElementById('zoomOut').addEventListener('click', () => this.zoom(0.8));
                document.getElementById('resetView').addEventListener('click', () => this.resetGraphView());
                document.getElementById('addFunction').addEventListener('click', () => {
                    const input = document.getElementById('functionInput');
                    input.style.display = input.style.display === 'none' ? 'block' : 'none';
                });
                document.getElementById('plotFunction').addEventListener('click', () => this.plotFunction());

                // Fraction calculator
                document.getElementById('calculateFractions').addEventListener('click', () => this.calculateFractions());
                document.getElementById('simplifyBtn').addEventListener('click', () => this.showSimplification());

                // Solver
                document.getElementById('solveBtn').addEventListener('click', () => this.solve());

                // Matrix
                document.getElementById('matrixSize').addEventListener('change', (e) => {
                    this.generateMatrixInput(parseInt(e.target.value));
                });
                document.getElementById('matrixSolveBtn').addEventListener('click', () => this.solveMatrix());

                // Graph touch events
                this.setupGraphInteraction();

                // Keyboard support
                document.addEventListener('keydown', (e) => this.handleKeyboard(e));
            }

            // –í–°–ï –§–£–ù–ö–¶–ò–ò –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê
            switchMode(mode) {
                document.querySelectorAll('.mode-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.mode === mode);
                });

                document.querySelectorAll('.mode-content').forEach(content => {
                    content.classList.remove('active');
                });

                document.getElementById(`${mode}-mode`).classList.add('active');

                if (mode === 'graph') {
                    setTimeout(() => this.resizeCanvas(), 100);
                }
                if (mode === 'memory') {
                    this.generateMemoryCells();
                }
            }

            updateKeyboardForMode() {
                this.mainKeyboard.className = 'calculator-keyboard';
                this.mainKeyboard.classList.add(this.currentComplexity);

                // Remove duplicate equals button if exists
                const equalsButtons = this.mainKeyboard.querySelectorAll('[data-action="equals"]');
                if (equalsButtons.length > 1) {
                    equalsButtons[1].remove();
                }

                // Update visibility based on complexity
                const buttons = this.mainKeyboard.querySelectorAll('.calc-btn');
                buttons.forEach(btn => {
                    const action = btn.dataset.action;
                    const value = btn.dataset.value;
                    
                    switch(this.currentComplexity) {
                        case 'beginner':
                            if (action && !['clear', 'backspace', 'equals', 'add', 'subtract', 'multiply', 'divide'].includes(action)) {
                                btn.style.display = 'none';
                            } else if (!value && !action) {
                                btn.style.display = 'none';
                            } else {
                                btn.style.display = 'flex';
                            }
                            break;
                        case 'ovz':
                            btn.style.display = 'flex';
                            if (value) {
                                btn.style.fontSize = '32px';
                                btn.style.fontWeight = '900';
                            }
                            break;
                        case 'middle':
                            if (action && ['memory-toggle', 'cube', 'factorial'].includes(action)) {
                                btn.style.display = 'none';
                            } else {
                                btn.style.display = 'flex';
                            }
                            break;
                        default:
                            btn.style.display = 'flex';
                            break;
                    }
                });

                // Update scientific panel
                switch(this.currentComplexity) {
                    case 'beginner':
                        this.scientificPanel.style.display = 'none';
                        this.advancedPanel.style.display = 'none';
                        break;
                    case 'ovz':
                        this.scientificPanel.style.display = 'grid';
                        this.advancedPanel.style.display = 'none';
                        break;
                    default:
                        this.scientificPanel.style.display = 'grid';
                        this.advancedPanel.style.display = 'none';
                        break;
                }
            }

            // –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –í–í–û–î–ê
            appendValue(value) {
                if (this.result !== '0' && this.expression === '') {
                    this.expression = this.result;
                }
                this.expression += value;
                this.updateDisplay();
            }

            handleAction(action) {
                switch(action) {
                    case 'clear':
                        this.expression = '';
                        this.result = '0';
                        break;
                    case 'backspace':
                        this.expression = this.expression.slice(0, -1);
                        break;
                    case 'equals':
                        this.calculate();
                        return;
                    case 'add': this.expression += '+'; break;
                    case 'subtract': this.expression += '-'; break;
                    case 'multiply': this.expression += '*'; break;
                    case 'divide': this.expression += '/'; break;
                    case 'percent': this.expression += '/100'; break;
                    case 'sqrt': this.expression += '‚àö('; break;
                    case 'power': this.expression += '^2'; break;
                    case 'cube': this.expression += '^3'; break;
                    case '1/x': this.expression = `1/(${this.expression})`; break;
                    case 'factorial': this.expression += '!'; break;
                    case 'negate': this.expression += '*(-1)'; break;
                    case 'fraction': this.expression += '/'; break;
                    case 'advanced-toggle': this.advancedPanel.classList.toggle('open'); break;
                    case 'memory-toggle': this.memoryPanel.classList.toggle('open'); break;
                    case 'alpha': this.alphaMode = !this.alphaMode; break;
                    case 'mc': this.memory[this.currentMemory] = null; this.updateMemoryIndicator(); break;
                    case 'mr': 
                        if (this.memory[this.currentMemory] !== null) {
                            this.expression += this.memory[this.currentMemory];
                            this.updateDisplay();
                        }
                        break;
                    case 'm+': 
                        this.calculate();
                        if (this.result !== 'Error') {
                            const currentValue = this.memory[this.currentMemory] || 0;
                            this.memory[this.currentMemory] = currentValue + parseFloat(this.result);
                            this.updateMemoryIndicator();
                        }
                        break;
                    case 'm-':
                        this.calculate();
                        if (this.result !== 'Error') {
                            const currentValue = this.memory[this.currentMemory] || 0;
                            this.memory[this.currentMemory] = currentValue - parseFloat(this.result);
                            this.updateMemoryIndicator();
                        }
                        break;
                }
                this.updateDisplay();
            }

            insertFunction(func) {
                const functions = {
                    'sin': 'sin(', 'cos': 'cos(', 'tan': 'tan(', 'sin‚Åª¬π': 'asin(', 'cos‚Åª¬π': 'acos(',
                    'sinh': 'sinh(', 'cosh': 'cosh(', 'tanh': 'tanh(', 'log': 'log10(', 'ln': 'log(',
                    '‚àö': '‚àö(', '¬≥‚àö': 'cbrt(', 'x¬≤': '^2', 'x¬≥': '^3', 'x^y': '^', 'œÄ': 'pi', 'e': 'e',
                    'nCr': 'combinations(', 'nPr': 'permutations(', 'hyp': 'hypot(', 'Pol(': 'Pol(',
                    'Rec(': 'Rec(', 'S‚áÑD': this.switchDecimalFraction.bind(this), '(--)': '*(-1)',
                    'Ans': this.insertAnswer.bind(this), '(': '(', ')': ')', ',': ','
                };

                if (functions[func]) {
                    if (typeof functions[func] === 'function') {
                        functions[func]();
                    } else {
                        this.expression += functions[func];
                    }
                }
                this.updateDisplay();
            }

            insertAnswer() {
                if (this.lastAnswer !== null) {
                    this.expression += this.lastAnswer.toString();
                }
            }

            switchDecimalFraction() {
                if (this.result.includes('/')) {
                    const parts = this.result.split('/');
                    const decimal = parseFloat(parts[0]) / parseFloat(parts[1]);
                    this.result = this.formatNumber(decimal);
                } else {
                    const decimal = parseFloat(this.result);
                    const fraction = this.decimalToFraction(decimal);
                    this.result = `${fraction[0]}/${fraction[1]}`;
                }
                this.updateDisplay();
            }

            // –í–´–ß–ò–°–õ–ï–ù–ò–Ø
            calculate() {
                try {
                    let expr = this.expression;
                    
                    if (this.angleMode === 'deg') {
                        expr = expr.replace(/sin\(/g, 'sin(pi/180*');
                        expr = expr.replace(/cos\(/g, 'cos(pi/180*');
                        expr = expr.replace(/tan\(/g, 'tan(pi/180*');
                    }
                    
                    expr = expr.replace(/‚àö/g, 'sqrt');
                    expr = expr.replace(/,/g, '.');
                    
                    const result = math.evaluate(expr);
                    this.lastAnswer = result;
                    this.result = this.formatNumber(result);
                    this.addToHistory(this.expression, this.result);
                    this.expression = '';
                } catch (error) {
                    this.result = '–û—à–∏–±–∫–∞';
                    setTimeout(() => {
                        this.result = '0';
                        this.updateDisplay();
                    }, 2000);
                }
                this.updateDisplay();
            }

            formatNumber(num) {
                if (Math.abs(num) < 1e-10) return '0';
                if (Math.abs(num) > 1e10 || Math.abs(num) < 1e-4) {
                    return num.toExponential(this.precision).replace(/\./g, ',');
                }
                return parseFloat(num.toFixed(this.precision)).toString().replace(/\./g, ',');
            }

            updateDisplay() {
                let displayExpr = this.expression.replace(/sqrt/g, '‚àö');
                this.expressionDisplay.textContent = displayExpr || '';
                this.resultDisplay.textContent = this.result;
            }

            // –ü–ê–ú–Ø–¢–¨
            generateMemoryCells() {
                const containers = document.querySelectorAll('.memory-grid');
                containers.forEach(container => {
                    container.innerHTML = '';
                    for (let i = 0; i < 100; i++) {
                        const cell = document.createElement('div');
                        cell.className = `memory-cell ${this.memory[i] !== null ? 'used' : ''}`;
                        cell.dataset.index = i;
                        cell.textContent = `M${i}`;
                        if (this.memory[i] !== null) {
                            cell.title = this.memory[i];
                        }
                        container.appendChild(cell);
                    }
                });
            }

            useMemoryCell(index) {
                if (this.memory[index] !== null) {
                    this.expression += this.memory[index];
                    this.updateDisplay();
                }
            }

            updateMemoryIndicator() {
                const usedCount = this.memory.filter(cell => cell !== null).length;
                this.memoryIndicator.textContent = usedCount > 0 ? `M[${usedCount}]` : 'M';
            }

            // –ò–°–¢–û–†–ò–Ø
            addToHistory(expression, result) {
                const item = { expression, result, timestamp: Date.now() };
                this.history.unshift(item);
                if (this.history.length > 50) this.history = this.history.slice(0, 50);
                this.saveHistory();
                this.renderHistory();
            }

            renderHistory() {
                const container = document.getElementById('historyContainer');
                if (this.history.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';
                    return;
                }

                container.innerHTML = this.history.map(item => `
                    <div class="history-item" data-expression="${item.expression}">
                        <div class="history-expression">${item.expression}</div>
                        <div class="history-result">= ${item.result}</div>
                    </div>
                `).join('');

                container.querySelectorAll('.history-item').forEach(item => {
                    item.addEventListener('click', () => {
                        this.expression = item.dataset.expression;
                        this.switchMode('calculator');
                        this.updateDisplay();
                    });
                });
            }

            // –ì–†–ê–§–ò–ö–ò
            initializeGraph() {
                this.resizeCanvas();
            }

            resizeCanvas() {
                const container = this.graphCanvas.parentElement;
                this.graphCanvas.width = container.clientWidth;
                this.graphCanvas.height = container.clientHeight;
                this.redrawGraph();
            }

            setupGraphInteraction() {
                let isDragging = false;
                let lastX, lastY;

                this.graphCanvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (e.touches.length === 1) {
                        isDragging = true;
                        lastX = e.touches[0].clientX;
                        lastY = e.touches[0].clientY;
                    }
                });

                this.graphCanvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    if (e.touches.length === 1 && isDragging) {
                        const dx = e.touches[0].clientX - lastX;
                        const dy = e.touches[0].clientY - lastY;
                        this.graphState.offsetX += dx;
                        this.graphState.offsetY += dy;
                        lastX = e.touches[0].clientX;
                        lastY = e.touches[0].clientY;
                        this.redrawGraph();
                    }
                });

                this.graphCanvas.addEventListener('touchend', () => {
                    isDragging = false;
                });

                // Mouse events
                this.graphCanvas.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    lastX = e.clientX;
                    lastY = e.clientY;
                });

                this.graphCanvas.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        const dx = e.clientX - lastX;
                        const dy = e.clientY - lastY;
                        this.graphState.offsetX += dx;
                        this.graphState.offsetY += dy;
                        lastX = e.clientX;
                        lastY = e.clientY;
                        this.redrawGraph();
                    }
                });

                this.graphCanvas.addEventListener('mouseup', () => {
                    isDragging = false;
                });

                this.graphCanvas.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const scale = e.deltaY > 0 ? 0.9 : 1.1;
                    this.zoom(scale);
                });
            }

            zoom(factor) {
                this.graphState.scale *= factor;
                this.graphState.scale = Math.max(5, Math.min(200, this.graphState.scale));
                this.redrawGraph();
            }

            resetGraphView() {
                this.graphState.scale = 40;
                this.graphState.offsetX = 0;
                this.graphState.offsetY = 0;
                this.redrawGraph();
            }

            plotFunction() {
                const input = document.getElementById('functionExpression');
                const expr = input.value.trim();
                
                if (!expr) return;

                try {
                    const func = math.compile(expr.replace(/^y\s*=\s*/, ''));
                    const colors = ['#2196F3', '#F44336', '#4CAF50', '#FF9800', '#9C27B0'];
                    const color = colors[this.graphState.functions.length % colors.length];
                    
                    this.graphState.functions.push({
                        expression: expr,
                        func: func,
                        color: color
                    });

                    input.value = '';
                    document.getElementById('functionInput').style.display = 'none';
                    this.redrawGraph();
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏: ' + error.message);
                }
            }

            redrawGraph() {
                const canvas = this.graphCanvas;
                const ctx = this.ctx;
                const width = canvas.width;
                const height = canvas.height;
                const centerX = width / 2 + this.graphState.offsetX;
                const centerY = height / 2 + this.graphState.offsetY;
                const scale = this.graphState.scale;

                // Clear canvas
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, width, height);

                // Draw grid
                ctx.strokeStyle = '#e0e0e0';
                ctx.lineWidth = 1;

                // Vertical lines
                for (let x = centerX % scale; x < width; x += scale) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, height);
                    ctx.stroke();
                }

                // Horizontal lines
                for (let y = centerY % scale; y < height; y += scale) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(width, y);
                    ctx.stroke();
                }

                // Draw axes
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 2;

                // X-axis
                ctx.beginPath();
                ctx.moveTo(0, centerY);
                    ctx.lineTo(width, centerY);
                ctx.stroke();

                // Y-axis
                ctx.beginPath();
                ctx.moveTo(centerX, 0);
                ctx.lineTo(centerX, height);
                ctx.stroke();

                // Draw functions
                this.graphState.functions.forEach(func => {
                    ctx.strokeStyle = func.color;
                    ctx.lineWidth = 2;
                    ctx.beginPath();

                    let started = false;
                    for (let px = 0; px < width; px++) {
                        const x = (px - centerX) / scale;
                        try {
                            const y = func.func.evaluate({ x: x });
                            if (typeof y === 'number' && isFinite(y)) {
                                const py = centerY - y * scale;
                                if (py >= 0 && py <= height) {
                                    if (!started) {
                                        ctx.moveTo(px, py);
                                        started = true;
                                    } else {
                                        ctx.lineTo(px, py);
                                    }
                                }
                            }
                        } catch (e) {
                            started = false;
                        }
                    }
                    ctx.stroke();
                });
            }

            // –î–†–û–ë–ò
            calculateFractions() {
                try {
                    const num1 = parseInt(document.getElementById('inputNum1').value) || 0;
                    const den1 = parseInt(document.getElementById('inputDen1').value) || 1;
                    const num2 = parseInt(document.getElementById('inputNum2').value) || 0;
                    const den2 = parseInt(document.getElementById('inputDen2').value) || 1;
                    const operator = document.getElementById('fracOperator').value;

                    if (den1 === 0 || den2 === 0) throw new Error('–ù—É–ª–µ–≤–æ–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å');

                    let resultNum, resultDen;

                    switch(operator) {
                        case '+':
                            resultNum = num1 * den2 + num2 * den1;
                            resultDen = den1 * den2;
                            break;
                        case '-':
                            resultNum = num1 * den2 - num2 * den1;
                            resultDen = den1 * den2;
                            break;
                        case '*':
                            resultNum = num1 * num2;
                            resultDen = den1 * den2;
                            break;
                        case '/':
                            resultNum = num1 * den2;
                            resultDen = den1 * num2;
                            break;
                    }

                    const simplified = this.simplifyFraction(resultNum, resultDen);
                    document.getElementById('fractionResult').innerHTML = `
                        <div class="fraction-display" style="margin: 0 auto;">
                            <div class="fraction-numerator">${simplified.numerator}</div>
                            <div class="fraction-line"></div>
                            <div class="fraction-denominator">${simplified.denominator}</div>
                        </div>
                    `;

                    const resultFraction = document.getElementById('resultFraction');
                    resultFraction.innerHTML = `
                        <div class="fraction-numerator">${simplified.numerator}</div>
                        <div class="fraction-line"></div>
                        <div class="fraction-denominator">${simplified.denominator}</div>
                    `;

                } catch (error) {
                    document.getElementById('fractionResult').textContent = '–û—à–∏–±–∫–∞';
                }
            }

            simplifyFraction(numerator, denominator) {
                const gcd = this.calculateGCD(numerator, denominator);
                return {
                    numerator: numerator / gcd,
                    denominator: denominator / gcd
                };
            }

            calculateGCD(a, b) {
                a = Math.abs(a);
                b = Math.abs(b);
                while (b !== 0) {
                    const temp = b;
                    b = a % b;
                    a = temp;
                }
                return a;
            }

            showSimplification() {
                try {
                    const numerator = parseInt(document.getElementById('inputNum1').value) || 0;
                    const denominator = parseInt(document.getElementById('inputDen1').value) || 1;

                    if (denominator === 0) throw new Error('–ù—É–ª–µ–≤–æ–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å');

                    const gcd = this.calculateGCD(numerator, denominator);
                    const simplifiedNum = numerator / gcd;
                    const simplifiedDen = denominator / gcd;

                    let stepsHTML = '';

                    if (gcd > 1) {
                        stepsHTML = `
                            <div class="fraction-step">
                                <span>${numerator}/${denominator}</span>
                            </div>
                            <div class="fraction-step">
                                <span>–ù–û–î = ${gcd}</span>
                            </div>
                            <div class="fraction-step">
                                <div class="fraction-display" style="display: inline-flex;">
                                    <div class="fraction-numerator">
                                        <span class="crossed-number">${numerator}</span> ‚Üí ${simplifiedNum}
                                    </div>
                                    <div class="fraction-line"></div>
                                    <div class="fraction-denominator">
                                        <span class="crossed-number">${denominator}</span> ‚Üí ${simplifiedDen}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        stepsHTML = `
                            <div class="fraction-step">
                                <span>–£–∂–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∞</span>
                            </div>
                            <div class="fraction-step">
                                <span>–ù–û–î = 1</span>
                            </div>
                        `;
                    }

                    document.getElementById('simplificationSteps').innerHTML = stepsHTML;
                    document.getElementById('simplificationPanel').style.display = 'block';
                } catch (error) {
                    document.getElementById('simplificationSteps').innerHTML = '–û—à–∏–±–∫–∞';
                    document.getElementById('simplificationPanel').style.display = 'block';
                }
            }

            decimalToFraction(decimal) {
                const tolerance = 1.0E-6;
                let numerator = 1;
                let denominator = 1;
                let fraction = numerator / denominator;
                
                while (Math.abs(fraction - decimal) > tolerance) {
                    if (fraction < decimal) {
                        numerator++;
                    } else {
                        denominator++;
                        numerator = Math.round(decimal * denominator);
                    }
                    fraction = numerator / denominator;
                }
                return [numerator, denominator];
            }

            // –†–ï–®–ê–¢–ï–õ–¨
            solve() {
                const type = document.getElementById('solverType').value;
                const expression = document.getElementById('solverExpression').value;
                const variable = document.getElementById('solverVariable').value || 'x';

                if (!expression) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ');
                    return;
                }

                const stepsContainer = document.getElementById('solutionSteps');
                stepsContainer.style.display = 'block';
                stepsContainer.innerHTML = '<div class="spinner"></div>';

                setTimeout(() => {
                    try {
                        let steps = [];
                        let result;

                        switch(type) {
                            case 'equation':
                                result = this.solveEquation(expression, variable);
                                steps = result.steps;
                                break;
                            case 'derivative':
                                result = math.derivative(expression, variable).toString();
                                steps = [{title: '–ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è', content: result}];
                                break;
                            case 'integral':
                                result = this.solveIntegral(expression, variable);
                                steps = result.steps;
                                break;
                        }

                        this.renderSolutionSteps(steps);
                    } catch (error) {
                        stepsContainer.innerHTML = `
                            <div class="step">
                                <div class="step-title">‚ùå –û—à–∏–±–∫–∞</div>
                                <div class="step-content">${error.message}</div>
                            </div>
                        `;
                    }
                }, 100);
            }

            solveEquation(expr, variable) {
                const steps = [];
                steps.push({title: '–ò—Å—Ö–æ–¥–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ', content: expr});

                try {
                    const solutions = [];
                    for (let x = -10; x <= 10; x++) {
                        try {
                            const value = math.evaluate(expr.replace(new RegExp(variable, 'g'), `(${x})`));
                            if (Math.abs(value) < 1e-10) {
                                solutions.push(x);
                            }
                        } catch (e) {}
                    }

                    if (solutions.length > 0) {
                        steps.push({
                            title: '‚úì –†–µ—à–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ',
                            content: solutions.map(s => `${variable} = ${s}`).join('\n')
                        });
                    } else {
                        steps.push({
                            title: '‚ö† –†–µ—à–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                            content: '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ'
                        });
                    }

                } catch (error) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ—à–∏—Ç—å —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: ' + error.message);
                }

                return { steps };
            }

            solveIntegral(expr, variable) {
                const steps = [];
                steps.push({title: '–ò—Å—Ö–æ–¥–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è', content: `‚à´ ${expr} d${variable}`});
                steps.push({title: '–ú–µ—Ç–æ–¥ —Ä–µ—à–µ–Ω–∏—è', content: '–ò—Å–ø–æ–ª—å–∑—É–µ–º —á–∏—Å–ª–µ–Ω–Ω–æ–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ'});

                try {
                    const func = math.compile(expr);
                    const a = 0, b = 10;
                    const n = 1000;
                    const h = (b - a) / n;
                    let sum = func.evaluate({ [variable]: a }) + func.evaluate({ [variable]: b });

                    for (let i = 1; i < n; i++) {
                        const x = a + i * h;
                        const weight = i % 2 === 0 ? 2 : 4;
                        sum += weight * func.evaluate({ [variable]: x });
                    }

                    const result = (h / 3) * sum;

                    steps.push({
                        title: '‚úì –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞–ª',
                        content: `‚à´[${a}, ${b}] ${expr} d${variable} ‚âà ${this.formatNumber(result)}`
                    });

                } catch (error) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—á–∏—Å–ª–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞–ª: ' + error.message);
                }

                return { steps };
            }

            renderSolutionSteps(steps) {
                const container = document.getElementById('solutionSteps');
                container.innerHTML = steps.map(step => `
                    <div class="step">
                        <div class="step-title">${step.title}</div>
                        <div class="step-content">${step.content.replace(/\n/g, '<br>')}</div>
                    </div>
                `).join('');
            }

            // –ú–ê–¢–†–ò–¶–´
            generateMatrixInput(size) {
                const container = document.getElementById('matrixA');
                container.innerHTML = '';
                
                for (let i = 0; i < size; i++) {
                    const row = document.createElement('div');
                    row.className = 'matrix-row';
                    for (let j = 0; j < size; j++) {
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.className = 'matrix-cell';
                        input.placeholder = '0';
                        input.dataset.row = i;
                        input.dataset.col = j;
                        row.appendChild(input);
                    }
                    container.appendChild(row);
                }
            }

            solveMatrix() {
                const operation = document.getElementById('matrixOperation').value;
                const matrix = this.getMatrixValues();
                const resultContainer = document.getElementById('matrixResult');
                
                resultContainer.style.display = 'block';
                resultContainer.innerHTML = '<div class="spinner"></div>';

                setTimeout(() => {
                    try {
                        let result;
                        let html = '';

                        switch(operation) {
                            case 'determinant':
                                result = math.det(matrix);
                                html = `<div class="step"><div class="step-title">‚úì –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å</div><div class="step-content">det(A) = ${this.formatNumber(result)}</div></div>`;
                                break;
                            case 'inverse':
                                result = math.inv(matrix);
                                html = `<div class="step"><div class="step-title">‚úì –û–±—Ä–∞—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞</div><div class="step-content">${this.formatMatrix(result)}</div></div>`;
                                break;
                            case 'transpose':
                                result = math.transpose(matrix);
                                html = `<div class="step"><div class="step-title">‚úì –¢—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞</div><div class="step-content">${this.formatMatrix(result)}</div></div>`;
                                break;
                        }

                        resultContainer.innerHTML = html;
                    } catch (error) {
                        resultContainer.innerHTML = `<div class="step"><div class="step-title">‚ùå –û—à–∏–±–∫–∞</div><div class="step-content">${error.message}</div></div>`;
                    }
                }, 100);
            }

            getMatrixValues() {
                const size = parseInt(document.getElementById('matrixSize').value);
                const matrix = [];
                
                for (let i = 0; i < size; i++) {
                    matrix[i] = [];
                    for (let j = 0; j < size; j++) {
                        const input = document.querySelector(`input[data-row="${i}"][data-col="${j}"]`);
                        matrix[i][j] = parseFloat(input.value) || 0;
                    }
                }
                
                return matrix;
            }

            formatMatrix(matrix) {
                return matrix.map(row => 
                    row.map(val => this.formatNumber(val)).join('  ')
                ).join('<br>');
            }

            // –ö–õ–ê–í–ò–ê–¢–£–†–ê
            handleKeyboard(e) {
                if (document.getElementById('calculator-mode').classList.contains('active')) {
                    const key = e.key;
                    
                    if (/[0-9.,]/.test(key)) {
                        this.appendValue(key);
                    } else if (key === 'Enter') {
                        this.calculate();
                    } else if (key === 'Backspace') {
                        this.handleAction('backspace');
                    } else if (key === 'Escape') {
                        this.handleAction('clear');
                    } else if (['+', '-', '*', '/'].includes(key)) {
                        this.expression += key;
                        this.updateDisplay();
                    }
                }
            }

            // –ù–ê–°–¢–†–û–ô–ö–ò –ò –°–û–•–†–ê–ù–ï–ù–ò–ï
            saveSettings() {
                const settings = {
                    soundEnabled: this.soundEnabled,
                    vibrationEnabled: this.vibrationEnabled,
                    precision: this.precision,
                    angleMode: this.angleMode,
                    currentMode: this.currentMode,
                    currentComplexity: this.currentComplexity
                };
                localStorage.setItem('calculatorSettings', JSON.stringify(settings));
            }

            loadSettings() {
                const saved = localStorage.getItem('calculatorSettings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    this.soundEnabled = settings.soundEnabled !== false;
                    this.vibrationEnabled = settings.vibrationEnabled !== false;
                    this.precision = settings.precision || 6;
                    this.angleMode = settings.angleMode || 'deg';
                    this.currentMode = settings.currentMode || 'computational';
                    this.currentComplexity = settings.currentComplexity || 'balance';

                    document.getElementById('soundToggle').checked = this.soundEnabled;
                    document.getElementById('vibrationToggle').checked = this.vibrationEnabled;
                    document.getElementById('precisionSelect').value = this.precision;
                    document.getElementById('angleMode').value = this.angleMode;

                    this.updateKeyboardForMode();
                }
            }

            saveHistory() {
                localStorage.setItem('calculator_history', JSON.stringify(this.history));
            }

            loadHistory() {
                const saved = localStorage.getItem('calculator_history');
                return saved ? JSON.parse(saved) : [];
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            window.calculator = new UltimateCalculator();
        });

        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                if (window.calculator) {
                    window.calculator.resizeCanvas();
                }
            }, 100);
        });
    </script>
</body>
</html>
